version: '2'
services:
  postgresratmap: #how to add custom conf
    image: postgres
    env_file: .env    
    command: postgres -c config_file=/etc/postgresql.conf
    volumes:
      - ./configEnv/postgresql.conf:/etc/postgresql.conf
      - ./configEnv/pg_backup.config:/etc/default/pg_backup.config
      - ./configEnv/pg_backup_rotated.sh:/usr/bin/pg_backup_rotated.sh
      - ./log/postgresql/:/log/
      - /backup/ratmap/database/:/backup/
    ports:
      - '127.0.0.1:5432:5432'
  redis:
    image: redis
    command: redis-server
    ports:
      - '127.0.0.1:6379:6379'

  ratmap:
    build: .
    env_file: .env
    command: supervisord -c /etc/supervisor/conf.d/supervisord.conf    
    volumes:
      - .:/ratmap
      - ./config/supervisord.conf:/etc/supervisor/conf.d/supervisord.conf  
    ports:
        - '127.0.0.1:30001:30001'
        - '127.0.0.1:30000:30000'
    links:
      - postgresratmap 
      - redis

#TODO:
#* change volume mount in production
# - mount ro everything mount rw sharred
#* database backup
#* watchtower
